<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Processing formulas in <code>ergmito</code> — ergmito_formulae • ergmito</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Processing formulas in <code>ergmito</code> — ergmito_formulae" />
<meta property="og:description" content="Analyze formula objects returning the matrices of weights and sufficient
statistics to be used in the model together with the log-likelihood and
gradient functions for joint models." />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70821549-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70821549-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ergmito</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2-1-9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ergm-equations.html">ERGM equations</a>
    </li>
    <li>
      <a href="../articles/extending-ergmito.html">Extending ergmito</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/muriteams/ergmito/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Processing formulas in <code>ergmito</code></h1>
    <small class="dont-index">Source: <a href='https://github.com/muriteams/ergmito/blob/master/R/formulae.R'><code>R/formulae.R</code></a></small>
    <div class="hidden name"><code>ergmito_formulae.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Analyze formula objects returning the matrices of weights and sufficient
statistics to be used in the model together with the log-likelihood and
gradient functions for joint models.</p>
    </div>

    <pre class="usage"><span class='fu'>ergmito_formulae</span>(
  <span class='no'>model</span>,
  <span class='kw'>model_update</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>target_stats</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>stats_weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>stats_statmat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>target_offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>stats_offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>env</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span>(),
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>A formula. The left-hand-side can be either a small network, or
a list of networks.</p></td>
    </tr>
    <tr>
      <th>model_update</th>
      <td><p>A formula. If specified, the after computing the
sufficient statistics (observed and support), the model is updated using
<code><a href='https://rdrr.io/r/stats/model.frame.html'>stats::model.frame()</a></code>. This includes processing offset terms.</p></td>
    </tr>
    <tr>
      <th>target_stats</th>
      <td><p>Observed statistics. If multiple networks, then a list, otherwise
a named vector (see <a href='https://rdrr.io/pkg/ergm/man/summary_formula.html'>ergm::summary_formula</a>).</p></td>
    </tr>
    <tr>
      <th>stats_weights, stats_statmat</th>
      <td><p>Lists of sufficient statistics and their
respective weights.</p></td>
    </tr>
    <tr>
      <th>target_offset, stats_offset</th>
      <td><p>See <code><a href='exact_loglik.html'>exact_loglik()</a></code>.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>Environment in which <code>model</code> should be evaluated.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <a href='https://rdrr.io/pkg/ergm/man/ergm.allstats.html'>ergm::ergm.allstats</a>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of class <code>ergmito_loglik</code>.</p><ul>
<li><p><code>loglik</code> A function. The log-likelihood function.</p></li>
<li><p><code>grad</code> A function. The gradient of the model.</p></li>
<li><p><code>stats_weights</code>,<code>stats_statmat</code> two list of objects as returned by
<a href='https://rdrr.io/pkg/ergm/man/ergm.allstats.html'>ergm::ergm.allstats</a>.</p></li>
<li><p><code>target_offset</code>,<code>stats_offset</code> A vector of offset terms and a list of
vectors of offset terms, one for the target stats and the other for the
support of the sufficient statistics (defaults to 0).</p></li>
<li><p><code>model</code> A formula. The model passed.</p></li>
<li><p><code>npars</code> Integer. Number of parameters.</p></li>
<li><p><code>nnets</code> Integer. Number of networks in the model.</p></li>
<li><p><code>vertex_attr</code> Character vector. Vertex attributes used in the model.</p></li>
<li><p><code>term_names</code> Names of the terms used in the model.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>One of the main advantages of been able to compute exact likelihoods is that
we can build arbitrarily complex models in the same way that we would do in
the context of Generalized Linear Models, this is, adding offset terms,
interaction effects, or transformations of statistics without much effort.</p>
<p>In particular, if the user passes a formula via <code>model_update</code>, the
cannonical additive ERGM can be modified to include other terms, for example,
if we wanted to add an interaction effect of the <code>nodematch("age")</code> with
network size, we can simply type</p><pre><span class='no'>model_update</span> <span class='kw'>=</span> ~ <span class='no'>.</span> + <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>nodematch.age</span> * <span class='no'>n</span>)</pre>

<p>The <code><a href='https://rdrr.io/r/base/AsIs.html'>I()</a></code> function allows operating over variables in the model, in this case,
we took the <code>nodematch.age</code> variable (which is the name that <code><a href='https://rdrr.io/pkg/ergm/man/ergm.html'>ergm::ergm()</a></code>
assigns to it after computing the sufficient statistics) and multiplied it by
<code>n</code>, which is the network size (this variable is included by default).</p>
<p>By default, the ergm package calculates up to 2^16 unique values for the
vector of sufficient statistics. This results in issues if the user tries to
fit a model with too heterogenous networks or sets of attributes. To deal
with this it suffices with adding the option <code>maxNumChangeStatVectors</code> in
the ergmito call, e.g.:</p><pre><span class='co'># Networks of size 5 have up to 2^20 unique sets of sufficient statistics</span>
<span class='fu'><a href='ergmito.html'>ergmito</a></span>(<span class='no'>...</span>, <span class='kw'>maxNumChangeStatVectors</span> <span class='kw'>=</span> <span class='fl'>2</span>^<span class='fl'>20</span>)</pre>

<p>See more in ?<a href='https://rdrr.io/pkg/ergm/man/ergm.allstats.html'>ergm::ergm.allstats</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>fivenets</span>)
<span class='no'>model0</span> <span class='kw'>&lt;-</span> <span class='fu'>ergmito_formulae</span>(<span class='no'>fivenets</span> ~ <span class='no'>edges</span> + <span class='fu'>nodematch</span>(<span class='st'>"female"</span>))
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>model0</span>)</div><div class='output co'>#&gt; ergmito log-likelihood function
#&gt; Number of networks:  5 
#&gt; Model:  fivenets ~ edges + nodematch("female") 
#&gt; Available elements by using the $ operator:
#&gt; loglik: function (params, ...) grad  : function (params, ...) </div><div class='input'><span class='no'>model0</span>$<span class='fu'>loglik</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>2</span>, <span class='fl'>2</span>))</div><div class='output co'>#&gt; [1] -34.86713</div><div class='input'>
<span class='co'># Model with interaction effects and an offset term</span>
<span class='no'>model1</span> <span class='kw'>&lt;-</span> <span class='fu'>ergmito_formulae</span>(
  <span class='no'>fivenets</span> ~ <span class='no'>edges</span> + <span class='fu'>nodematch</span>(<span class='st'>"female"</span>),
  <span class='kw'>model_update</span> <span class='kw'>=</span> ~ <span class='no'>.</span> + <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span>(<span class='no'>edges</span>) + <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>edges</span> * <span class='no'>nodematch.female</span>)
)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by George Vega Yon, Army Research Laboratory and the U.S. Army Research Office.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


