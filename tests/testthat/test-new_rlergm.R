context("Sampler")

test_that("Using the count_stats vs ergm::summary_formula is equal", {
  
  set.seed(45532)
  nets <- rbernoulli(c(4,3,4))
  
  Sys.setenv(ERGMITO_TEST = "")
  set.seed(1);ans0 <- new_rergmito(nets ~ edges + mutual, sizes = 3, mc.cores = 1L)
  Sys.setenv(ERGMITO_TEST = 1)
  set.seed(1);ans1 <- new_rergmito(nets ~ edges + mutual, sizes = 3, mc.cores = 1L, force = TRUE)
  
  expect_equal(ans0$prob, ans1$prob)
  expect_equal(sum(ans0$prob$`3`), 1)
  
  # Sampler with the data
  data("fivenets")
  mod <- ergmito(fivenets ~ edges + nodematch("female"))
  network::delete.vertices(fivenets[[1]], 1)

  Sys.setenv(ERGMITO_TEST = "")  
  ans0 <- new_rergmito(fivenets[[1]] ~ edges + nodematch("female"), theta = coef(mod), mc.cores = 1L)
  Sys.setenv(ERGMITO_TEST = 1)
  ans1 <- new_rergmito(fivenets[[1]] ~ edges + nodematch("female"), theta = coef(mod), mc.cores = 1L, force = TRUE)

  
  expect_equal(ans0$prob, ans1$prob)
  expect_equal(sum(ans0$prob$`3`), 1)
  
})
